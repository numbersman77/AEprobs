---
title: "SAVVY: estimation of AE probabilities"
author: "Kaspar Rufibach, on behalf of the SAVVY working group"
date: "Last change: `r format(Sys.time(), '%d %B, %Y')`"
output: 
  rmarkdown::html_document:
    highlight: pygments
    number_sections: yes
    self_contained: yes
    toc: yes
    toc_depth: 3
    toc_float: yes
---

This R markdown file provides the code accompanying the slide deck [Efficient use of futility and efficacy interim analyses in group-sequential designs](Toolbox1_Rufibach_Wolbers_EfficientInterimsBiostatistics.pdf) within the course [A toolbox for innovative confirmatory trial designs](https://go.roche.com/adaptr/toolbox.html).

# Setup

Load rpact and further packages and define shortcut for sample size function.

```{r, include=TRUE, echo=TRUE}
# Load rpact
library(rpact)
library(knitr)

# shortcut for sample size function, to streamline code
myGetSampleSizeSurvival <- function(design){
    tmp <- getSampleSizeSurvival(design = design,
                        lambda2 = log(2) / m1, hazardRatio = hr,
                        dropoutRate1 = dout1, dropoutRate2 = dout2, dropoutTime = douttime,
                        accrualTime = accrualTime, accrualIntensity = accrualIntensity,
                        maxNumberOfSubjects = maxNumberOfSubjects)  
    return(tmp)
}
```

# Specify details of example trial
```{r, include=TRUE, echo=TRUE}
# design parameters
alpha <- 0.05
beta <- 0.2
m1 <- 6 * 12
m2 <- 8 * 12
hr <- m1 / m2

# constant for computation of variance for log(hr)
# as a function of P(randomized to A)
pA <- 1 / 2     # 1:1 randomization
kappa <- (pA * (1 - pA)) ^ (-1)

# timing parameters
dout1 <- 0.025
dout2 <- 0.025
douttime <- 12
accrualTime <- 0:6
accrualIntensity <- seq(6, 42, by = 6)
maxNumberOfSubjects <- 1200

# informal futility boundary
inform_bound <- 1
```

